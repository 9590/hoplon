(page "index.html")

(def ^:dynamic *book-data* (cell []))

(defelem+ table-of-contents
  [_ _]
  (div
    (h3 "Table of Contents")
    (div
      (loop-tpl
        :bindings [{:keys [num title]} *book-data*]
        (p (a :href "#" (text "~{num}...~{title}")))))))

(defelem+ chapter
  [{:keys [title]} kids]
  (let [chapter? #(= :chapter (:type %))
        chapters (filter chapter? @*book-data*)
        num      (inc (count chapters))
        this-toc {:type :chapter :num num :title title}]
    (swap! *book-data* conj this-toc)
    (section
      (h1
        (text "Chapter ~{num}: ~{title}"))
      kids)))

;;---------------------------------------------------------------------------;;

(cell= (pr :book-data *book-data*))

(time
  (html
    (head
      (style "td { vertical-align:top; padding:10px; }"))
    (body
      (table
        (tr (td (table-of-contents))
            (td (chapter
                  :title "Things and Stuff"
                  (p "Some words about things.")
                  (p "Some more words about things."))
                (chapter
                  :title "Other Things"
                  (p "More information."))))))))
